<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Legado San Jos√©</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JT5P73Z3EV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-JT5P73Z3EV');
    </script>

    <link rel="stylesheet" href="admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Prevent flash: hide everything until JS decides what to show -->
    <script>
        if (localStorage.getItem('admin_token')) {
            document.write('<style>#login-screen{display:none !important}</style>');
        }
    </script>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <h1>LEGADO SAN JOS√â</h1>
                <p>Panel de Administraci√≥n</p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Correo Electr√≥nico</label>
                    <input type="email" id="email" required placeholder="admin@gmail.com">
                </div>
                <div class="form-group">
                    <label for="password">Contrase√±a</label>
                    <input type="password" id="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" class="btn-primary">Iniciar Sesi√≥n</button>
                <p id="login-error" class="error-msg"></p>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="dashboard-container" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>LEGADO</h2>
                <span>Admin</span>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-section="products">
                    <span class="icon">üì¶</span> Productos
                </a>
                <a href="#" class="nav-item" data-section="orders">
                    <span class="icon">üßæ</span> Pedidos
                </a>
                <a href="#" class="nav-item" data-section="gallery">
                    <span class="icon">üñºÔ∏è</span> Galer√≠a
                </a>
                <a href="#" class="nav-item" data-section="categories">
                    <span class="icon">üè∑Ô∏è</span> Categor√≠as
                </a>
                <a href="#" class="nav-item" data-section="discounts">
                    <span class="icon">üí∞</span> Descuentos
                </a>
                <a href="#" class="nav-item" data-section="pages">
                    <span class="icon">üìÑ</span> P√°ginas
                </a>
                <a href="#" class="nav-item" data-section="subscribers">
                    <span class="icon">üìß</span> Suscriptores
                </a>
                <a href="#" class="nav-item" data-section="content">
                    <span class="icon">üìù</span> Contenido
                </a>
                <a href="#" class="nav-item" data-section="settings">
                    <span class="icon">‚öôÔ∏è</span> Configuraci√≥n
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="admin-info">
                    <span id="admin-name">Admin</span>
                    <small id="admin-email">admin@gmail.com</small>
                </div>
                <button id="logout-btn" class="btn-logout">Cerrar Sesi√≥n</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Products Section -->
            <section id="products-section" class="section active">
                <div class="section-header">
                    <h1>Productos</h1>
                    <button id="add-product-btn" class="btn-primary">+ Nuevo Producto</button>
                </div>
                <div class="products-grid" id="admin-products-grid">
                    <!-- Products will be loaded here -->
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders-section" class="section">
                <div class="section-header">
                    <h1>Pedidos</h1>
                </div>
                <div id="orders-list">
                    <p style="text-align: center; color: #888; padding: 40px;">No hay pedidos a√∫n.</p>
                </div>
            </section>

            <!-- Gallery Section -->
            <section id="gallery-section" class="section">
                <div class="section-header">
                    <h1>Galer√≠a</h1>
                    <button id="add-gallery-btn" class="btn-primary">+ Agregar Imagen</button>
                </div>
                <div class="gallery-grid" id="admin-gallery-grid">
                    <!-- Gallery images will be loaded here -->
                </div>
            </section>

            <!-- Categories Section -->
            <section id="categories-section" class="section">
                <div class="section-header">
                    <h1>Categor√≠as</h1>
                    <button id="add-category-btn" class="btn-primary">+ Nueva Categor√≠a</button>
                </div>
                <div class="categories-list" id="admin-categories-list">
                    <!-- Categories will be loaded here -->
                </div>
            </section>

            <!-- Discounts Section -->
            <section id="discounts-section" class="section">
                <div class="section-header">
                    <h1>C√≥digos de Descuento</h1>
                    <button id="add-discount-btn" class="btn-primary">+ Nuevo C√≥digo</button>
                </div>
                <div id="discounts-list">
                    <!-- Discount codes will be loaded here -->
                </div>
            </section>

            <!-- Pages Section -->
            <section id="pages-section" class="section">
                <div class="section-header">
                    <h1>P√°ginas</h1>
                    <button id="add-page-btn" class="btn-primary">+ Nueva P√°gina</button>
                </div>
                <div id="pages-list">
                    <!-- Pages will be loaded here -->
                </div>
            </section>

            <!-- Subscribers Section -->
            <section id="subscribers-section" class="section">
                <div class="section-header">
                    <h1>Suscriptores</h1>
                    <button id="send-email-btn" class="btn-primary">üì® Enviar Email</button>
                </div>
                <div class="subscribers-stats" id="subscribers-stats">
                    <!-- Stats will be loaded here -->
                </div>
                <div id="subscribers-list">
                    <!-- Subscribers will be loaded here -->
                </div>
            </section>

            <!-- Content Section -->
            <section id="content-section" class="section">
                <div class="section-header">
                    <h1>Contenido del Sitio</h1>
                </div>
                <div class="content-editor" id="content-editor">
                    <!-- Content editor will be loaded here -->
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="section">
                <div class="section-header">
                    <h1>Configuraci√≥n</h1>
                </div>
                <div class="settings-content">
                    <div class="settings-card">
                        <h3>Estado del Sitio</h3>
                        <p class="settings-desc">Paura el sitio y muestra una p√°gina de "En Construcci√≥n" a los
                            visitantes.</p>
                        <div class="toggle-container">
                            <label class="switch">
                                <input type="checkbox" id="maintenance-toggle">
                                <span class="slider round"></span>
                            </label>
                            <span id="maintenance-status">Modo Mantenimiento Desactivado</span>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3>Cambiar Contrase√±a</h3>
                        <form id="change-password-form">
                            <div class="form-group">
                                <label for="current-password">Contrase√±a Actual</label>
                                <input type="password" id="current-password" required>
                            </div>
                            <div class="form-group">
                                <label for="new-password">Nueva Contrase√±a</label>
                                <input type="password" id="new-password" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label for="confirm-password">Confirmar Nueva Contrase√±a</label>
                                <input type="password" id="confirm-password" required minlength="6">
                            </div>
                            <button type="submit" class="btn-primary">Cambiar Contrase√±a</button>
                            <p id="password-message" class="message"></p>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="modal-title">Nuevo Producto</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="product-form">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-name">Nombre *</label>
                            <input type="text" id="product-name" required>
                        </div>
                        <div class="form-group">
                            <label for="product-price">Precio (MXN) *</label>
                            <input type="number" id="product-price" required min="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="product-category">Categor√≠a *</label>
                            <select id="product-category" required>
                                <option value="">Seleccionar...</option>
                                <!-- Categories will be loaded dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="product-active">Estado</label>
                            <select id="product-active">
                                <option value="true">Activo</option>
                                <option value="false">Inactivo</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" id="product-stock-group">
                            <label for="product-stock">Inventario General</label>
                            <input type="number" id="product-stock" min="0" placeholder="Dejar vac√≠o = ilimitado">
                            <small style="color: #888;">Dejar vac√≠o para inventario ilimitado</small>
                            <small id="stock-variant-note" class="stock-note" style="display: none; color: #F5A84F;">
                                ‚ö†Ô∏è Este producto tiene variantes ‚Äî el stock se gestiona por variante/talla abajo
                            </small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="product-description">Descripci√≥n</label>
                        <textarea id="product-description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Imagen Principal</label>
                        <div class="image-upload-area" id="main-image-upload">
                            <input type="file" id="main-image-input" accept="image/*" style="display: none;">
                            <div class="upload-placeholder"
                                onclick="document.getElementById('main-image-input').click()">
                                <span>üì∑</span>
                                <p>Click para subir imagen</p>
                            </div>
                            <img id="main-image-preview" class="image-preview" style="display: none;">
                        </div>
                        <input type="hidden" id="product-image-url">
                    </div>
                    <div class="form-group">
                        <label>Im√°genes Adicionales</label>
                        <div class="additional-images" id="additional-images">
                            <!-- Additional images will be added here -->
                        </div>
                        <button type="button" class="btn-secondary" onclick="addAdditionalImage()">+ Agregar
                            Imagen</button>
                    </div>
                    <div class="form-group">
                        <label for="product-sizes">Tallas (separadas por coma)</label>
                        <input type="text" id="product-sizes" placeholder="S, M, L, XL">
                    </div>
                    <div class="form-group">
                        <label>Variantes de Color</label>
                        <div id="variants-container">
                            <!-- Variants will be added here -->
                        </div>
                        <button type="button" class="btn-secondary" onclick="addVariant()">+ Agregar Variante</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary modal-cancel">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar Producto</button>
                </div>
                <input type="hidden" id="product-id">
            </form>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="gallery-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Agregar a Galer√≠a</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="gallery-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label>Imagen</label>
                        <div class="image-upload-area" id="gallery-image-upload">
                            <input type="file" id="gallery-image-input" accept="image/*" style="display: none;">
                            <div class="upload-placeholder"
                                onclick="document.getElementById('gallery-image-input').click()">
                                <span>üì∑</span>
                                <p>Click para subir imagen</p>
                            </div>
                            <img id="gallery-image-preview" class="image-preview" style="display: none;">
                        </div>
                        <input type="hidden" id="gallery-image-url">
                    </div>
                    <div class="form-group">
                        <label for="gallery-alt">Texto Alternativo</label>
                        <input type="text" id="gallery-alt" placeholder="Descripci√≥n de la imagen">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary modal-cancel">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content small">
            <div class="modal-header">
                <h2 id="confirm-title">Confirmar</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirm-message">¬øEst√°s seguro de que deseas eliminar este elemento?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary modal-cancel">Cancelar</button>
                <button type="button" class="btn-danger" id="confirm-delete-btn">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Input Prompt Modal -->
    <div id="input-prompt-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content small">
            <div class="modal-header">
                <h2 id="input-prompt-title">Ingresa un valor</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label id="input-prompt-label"></label>
                    <input type="text" id="input-prompt-value" placeholder="">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary modal-cancel">Cancelar</button>
                <button type="button" class="btn-primary" id="input-prompt-ok">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content small">
            <div class="modal-header">
                <h2 id="category-modal-title">Nueva Categor√≠a</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="category-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="category-name">Nombre de la Categor√≠a *</label>
                        <input type="text" id="category-name" required placeholder="Ej: Accesorios">
                    </div>
                    <div class="form-group">
                        <label for="category-active">Estado</label>
                        <select id="category-active">
                            <option value="true">Activa</option>
                            <option value="false">Inactiva</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary modal-cancel">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar</button>
                </div>
                <input type="hidden" id="category-id">
            </form>
        </div>
    </div>

    <!-- Discount Modal -->
    <div id="discount-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content small">
            <div class="modal-header">
                <h2 id="discount-modal-title">Nuevo C√≥digo de Descuento</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="discount-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="discount-code">C√≥digo *</label>
                        <input type="text" id="discount-code" required placeholder="Ej: VERANO20" style="text-transform: uppercase;">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="discount-type">Tipo de Descuento *</label>
                            <select id="discount-type" required>
                                <option value="percent">Porcentaje (%)</option>
                                <option value="fixed">Monto Fijo (MXN)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="discount-value">Valor *</label>
                            <input type="number" id="discount-value" required min="1" placeholder="Ej: 20">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="discount-max-uses">M√°ximo de Usos</label>
                            <input type="number" id="discount-max-uses" min="1" placeholder="Sin l√≠mite">
                        </div>
                        <div class="form-group">
                            <label for="discount-expires">Fecha de Expiraci√≥n</label>
                            <input type="date" id="discount-expires">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary modal-cancel">Cancelar</button>
                    <button type="submit" class="btn-primary">Crear C√≥digo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Page Modal -->
    <div id="page-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="page-modal-title">Nueva P√°gina</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="page-form">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="page-title">T√≠tulo *</label>
                            <input type="text" id="page-title" required placeholder="Ej: Aviso de Privacidad">
                        </div>
                        <div class="form-group">
                            <label for="page-active">Estado</label>
                            <select id="page-active">
                                <option value="true">Activa</option>
                                <option value="false">Inactiva</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="page-content">Contenido (HTML permitido)</label>
                        <textarea id="page-content" rows="15" placeholder="Escribe el contenido de la p√°gina..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary modal-cancel">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar P√°gina</button>
                </div>
                <input type="hidden" id="page-id">
            </form>
        </div>
    </div>

    <!-- Email Campaign Modal -->
    <div id="email-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Enviar Email a Suscriptores</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="email-form">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="email-subject">Asunto *</label>
                        <input type="text" id="email-subject" required placeholder="Ej: ¬°Nuevos productos disponibles!">
                    </div>
                    <div class="form-group">
                        <label for="email-header-text">Texto del Header</label>
                        <input type="text" id="email-header-text" placeholder="LEGADO SAN JOS√â" value="LEGADO SAN JOS√â">
                        <small style="color: #999; font-size: 12px; margin-top: 4px; display: block;">Aparece en la barra superior del email. D√©jalo vac√≠o para no mostrar header.</small>
                    </div>
                    <div class="form-group">
                        <label>Contenido *</label>
                        <div class="email-editor-wrapper">
                            <div class="email-toolbar">
                                <button type="button" class="toolbar-btn" data-cmd="bold" title="Negrita"><b>B</b></button>
                                <button type="button" class="toolbar-btn" data-cmd="italic" title="Cursiva"><i>I</i></button>
                                <button type="button" class="toolbar-btn" data-cmd="underline" title="Subrayado"><u>U</u></button>
                                <span class="toolbar-sep"></span>
                                <button type="button" class="toolbar-btn" data-cmd="formatBlock" data-value="h2" title="T√≠tulo">H</button>
                                <button type="button" class="toolbar-btn" data-cmd="formatBlock" data-value="p" title="P√°rrafo">¬∂</button>
                                <span class="toolbar-sep"></span>
                                <button type="button" class="toolbar-btn" data-cmd="insertUnorderedList" title="Lista con vi√±etas">‚Ä¢ Lista</button>
                                <button type="button" class="toolbar-btn" data-cmd="createLink" title="Insertar enlace">üîó Link</button>
                                <span class="toolbar-sep"></span>
                                <button type="button" class="toolbar-btn" data-cmd="justifyLeft" title="Alinear izquierda">‚´∑</button>
                                <button type="button" class="toolbar-btn" data-cmd="justifyCenter" title="Centrar">‚´ø</button>
                            </div>
                            <div class="email-editor" id="email-content" contenteditable="true" data-placeholder="Escribe tu email aqu√≠..."></div>
                        </div>
                    </div>
                    <div id="email-preview-section" style="display: none;">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Vista Previa:</label>
                        <div id="email-preview" style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; background: #fafafa; max-height: 300px; overflow-y: auto;"></div>
                    </div>
                    <p id="email-recipient-count" style="color: #888; font-size: 13px; margin-top: 12px;"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="email-preview-btn">Vista Previa</button>
                    <button type="button" class="btn-secondary modal-cancel">Cancelar</button>
                    <button type="submit" class="btn-primary">üì® Enviar a Todos</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <script src="admin.js"></script>
</body>

</html>